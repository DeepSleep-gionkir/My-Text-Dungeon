---

# 📚 프로젝트: AI 텍스트 던전 (가칭: Dungeon Prompt)

**Version:** 1.0 (Final Draft)
**Date:** 2026. 01. 24
**Tech Stack:** Firebase (Serverless), Gemini 2.5 Flash, React (Web)
**Genre:** UGC(User Generated Content) Text Roguelite RPG

중요!! 이 계획에 써있는 것과 다르게, 실제 게임은 next.js와 api routes를 통해 개발됩니다.

---

## 1. 🌟 게임 개요 (Game Overview)

### 1.1 핵심 컨셉 (Core Concept)

1.  **Create (창조):** 유저는 코딩이나 복잡한 툴 없이, **AI와의 채팅**만으로 몬스터, 함정, 스토리가 담긴 던전을 만든다.
2.  **Play (공략):** 다른 유저가 만든 던전에 도전한다. 로그라이크 방식이며, 매번 맵 구조가 바뀐다.
3.  **Visualize (시각화):** 생성형 이미지 없이, **고풍스러운 타이포그래피와 UI, 그리고 몰입감 넘치는 텍스트 로그**로 상상력을 자극한다.

### 1.2 타겟 오디언스

- TRPG(D&D)의 감성을 좋아하는 게이머.
- "내 설정놀이"를 남에게 보여주고 싶은 창작 욕구가 있는 유저.
- 가볍게 웹에서 즐길 수 있는 전략 게임을 찾는 유저.

---

## 2. 🗺️ 게임 구조 및 루프 (Game Loop)

### 2.1 메타 루프 (Meta Game - 던전 밖)

1.  **로비:** 내 캐릭터 성장(패시브), 상점 이용, 던전 목록 확인.
2.  **던전 제작:** AI 토큰을 소모하여 카드 생성 -> 덱 구성 -> 게시.
3.  **보상:** 던전 클리어 시 '골드' 획득 / 내 던전을 남이 플레이하면 '제작자 포인트' 획득.

### 2.2 인게임 루프 (In Game - 던전 안)

1.  **진입:** 1레벨, 기본 장비 + (선택한 유물 1~2개)로 시작.
2.  **탐험:** 갈림길 선택 -> 방 진입 -> **[카드 인카운터]**.
3.  **전투/이벤트:** 턴제 커맨드 전투 또는 주사위 스탯 체크.
4.  **성장:** 몬스터 처치 시 장비/스킬 획득 (해당 던전 내에서만 유지).
5.  **결말:** 보스 처치(클리어) 또는 사망(실패). 결과 정산 후 로비 복귀.

---

## 3. ⚔️ 전투 및 스탯 시스템 (Combat System)

### 3.1 캐릭터 스탯 (Stats)

- **HP (체력):** 0이 되면 사망.
- **MP (정신력):** 스킬 사용 시 소모. 0이 되면 `CONFUSION`(혼란) 상태 빠짐.
- **ATK (공격력):** 물리/마법 피해의 기본값.
- **DEF (방어력):** 받는 피해 감소.
- **SPD (속도):** 턴이 돌아오는 순서 및 회피율에 영향.
- **LUK (행운):** 치명타 확률, 상태이상 저항, 드랍율에 영향.

### 3.2 데미지 공식 (Damage Formula)

_복잡해 보이지만 시스템 내부 처리용입니다._

```javascript
FinalDamage =
  Attacker_ATK * Skill_Multiplier * Attribute_Factor - Defender_DEF * 0.5;
```

- **Attribute_Factor (속성 계수):**
  - 약점(Weakness) 공격 시: 1.5 ~ 2.0배
  - 내성(Resistance) 공격 시: 0.5배
  - 면역(Immunity) 공격 시: 0 (상태이상 안 걸림)
- **보정:** 최소 데미지는 1로 고정 (방어력이 아무리 높아도 1은 박힘).

### 3.3 전투 진행 (Turn Flow)

1.  **Turn Start:** DoT(독, 화상) 데미지 처리. 쿨타임 감소.
2.  **Action:** 플레이어 행동 선택 (공격/스킬/아이템/도주).
3.  **Resolution:** 명중/회피 판정 -> 데미지 계산 -> 상태이상 적용 -> 로그 출력.
4.  **Turn End:** 버프/디버프 지속시간 감소.

---

## 4. 🏷️ 시스템 태그 라이브러리 (Tag System)

_AI가 생성하는 JSON에 포함될 핵심 데이터입니다._

### A. 유닛 속성 (Unit Types)

| 태그            | 효과 및 특징                                           |
| :-------------- | :----------------------------------------------------- |
| `TAG_HUMANOID`  | 인간형. 정신 공격에 취약.                              |
| `TAG_UNDEAD`    | 언데드. 힐을 받으면 데미지. 출혈/독 면역. 신성에 취약. |
| `TAG_BEAST`     | 야수. 공포에 잘 걸림. 자연 마법 저항.                  |
| `TAG_CONSTRUCT` | 기계/구조물. 정신/출혈/독 면역. 방어력 높음.           |
| `TAG_ETHEREAL`  | 영체/유령. 물리 회피 50%. 마법에 취약.                 |
| `TAG_DRAGON`    | 용. 모든 상태이상 저항. 강력한 보스급.                 |
| `TAG_INSECT`    | 곤충. 불에 잘 탐(1.5배). 떼거지로 등장.                |

### B. 공격/방어 속성 (Elements)

| 태그             | 효과                                      |
| :--------------- | :---------------------------------------- |
| `ATTR_SLASH`     | 참격. 경장갑에 강함. 뼈(Skeleton)에 약함. |
| `ATTR_BLUNT`     | 타격. 중장갑/기계 부수기 좋음.            |
| `ATTR_PIERCE`    | 관통. 방어력 일부 무시.                   |
| `ATTR_FIRE`      | 화염. 화상 유발. 얼음에 강함.             |
| `ATTR_ICE`       | 냉기. 오한(속도감소) 유발.                |
| `ATTR_LIGHTNING` | 전기. 기계류에 추뎀. 젖은 상태에 치명타.  |
| `ATTR_HOLY`      | 신성. 언데드/악마 카운터.                 |
| `ATTR_DARK`      | 암흑. 흡혈 효과 동반.                     |
| `ATTR_POISON`    | 독. 지속 피해 스택 쌓기.                  |

### C. 상태이상 (Status Effects)

- **지속 피해:** `BURN`(화상), `POISON`(중독), `BLEED`(출혈), `ROT`(부패-최대체력감소)
- **제어기:** `STUN`(기절), `FREEZE`(빙결-깨짐), `SLEEP`(수면-치명타피격), `ROOT`(속박), `SILENCE`(침묵)
- **특수:** `BLIND`(실명-명중감소), `FEAR`(공포-행동실패), `CONFUSION`(혼란-아군공격), `TAUNT`(도발)
- **버프:** `REGEN`(재생), `MIGHT`(공격업), `IRON_SKIN`(방어업), `REFLECT`(반사), `STEALTH`(은신)

---

## 5. 🤖 AI 생성 시스템 (Builder System)

### 5.1 생성 프로세스

1.  **유저 입력:** "얼음 동굴에 사는 거대한 예티. 화나면 눈보라를 일으킴."
2.  **Prompting:** 시스템 프롬프트 + 유저 입력 + 난이도 계수 전송 (Gemini 2.5 Flash).
3.  **JSON Output:** AI가 `CardData` 포맷으로 반환.
4.  **Visualization:** 프론트엔드에서 카드 UI로 변환하여 유저에게 보여줌.

### 5.2 JSON 데이터 스키마 (최종)

```typescript
interface CardData {
  category:
    | "CARD_ENEMY_SINGLE"
    | "CARD_ENEMY_SQUAD"
    | "CARD_BOSS"
    | "CARD_TRAP_INSTANT"
    | "CARD_TRAP_ROOM"
    | "CARD_LOOT_CHEST"
    | "CARD_SHRINE"
    | "CARD_EVENT_CHOICE"
    | "CARD_NPC_TRADER";
  name: string;
  description: string; // 플레이버 텍스트
  grade: "NORMAL" | "ELITE" | "BOSS"; // 등급 (테두리 색상 결정)

  // 몬스터일 경우
  stats?: { hp: number; atk: number; def: number; spd: number };

  // 함정/이벤트일 경우 스탯 체크 정보
  check_info?: { stat: "AGI" | "LUK" | "STR"; difficulty: number };

  tags: string[]; // [TAG_BEAST, ATTR_ICE, ENV_COLD]

  // 행동 로직 (공격 패턴, 함정 발동 효과 등)
  actions: {
    trigger: "ON_TURN" | "ON_HIT" | "HP_BELOW_50" | "PASSIVE";
    type: "LOGIC_AOE" | "LOGIC_STUN" | "LOGIC_SUMMON" | "LOGIC_BUFF_SELF";
    value: number;
    msg: string; // "예티가 포효하며 눈보라를 일으킵니다!"
  }[];

  // 보상/드랍
  rewards?: { gold: number; items: string[] };
}
```

### 5.3 난이도 설정 (Difficulty)

- **쉬움:** 방 15개 / AI 스탯 계수 0.8 / 함정 데미지 낮음.
- **보통:** 방 25개 / AI 스탯 계수 1.0.
- **어려움:** 방 40개 / AI 스탯 계수 1.3 / 상태이상 저항 확률 증가.
- **악몽:** 방 50개 / AI 스탯 계수 1.8 / 보스급 몬스터 일반 방 등장.

---

## 6. 🎨 UI/UX 디자인 가이드 (No Image)

### 6.1 디자인 언어

- **테마:** Modern Dark Fantasy. 검정 배경 + 금색/은색/핏빛 포인트.
- **폰트:**
  - 제목: Serif (명조 계열) - 권위, 고전적 느낌.
  - 본문: Sans-serif (고딕 계열) - 가독성.
- **레이아웃:** 반응형 웹 (모바일 세로 / PC 가로).

### 6.2 주요 화면 구성

- **던전 플레이 화면:**
  - **상단:** `Room 12/30` 진행도 바. 현재 방 이름.
  - **중앙:** 적/오브젝트 카드 (CSS 애니메이션: 피격 시 진동, 상태이상 아이콘 부유).
  - **하단:** [전투 로그 창 (Scrollable)] + [커맨드 버튼 (Attack/Skill/Item)].
- **던전 제작 화면:**
  - **채팅 UI:** 카톡/슬랙 형태. AI와 대화.
  - **카드 덱 뷰:** 하단이나 측면에 생성된 카드들이 슬롯 형태로 쌓임. 클릭 시 상세 수정.

---

## 7. ☁️ 테크니컬 아키텍처 (Technical Spec)

### 7.1 Tech Stack (확정)

- **Frontend:** React (Vite) + Tailwind CSS + Zustand (상태관리).
- **Backend:** Firebase Cloud Functions (Node.js 20).
- **Database:** Cloud Firestore (NoSQL).
- **Auth:** Firebase Authentication (Google Only).
- **AI:** Google Gemini 2.5 Flash API.

### 7.2 데이터베이스 구조 (Firestore)

- `users/{uid}`: 유저 정보, 재화, 해금 목록.
- `dungeons/{did}`: 게시된 던전 정보, `card_list` (JSON Array).
- `play_logs/{lid}`: (옵션) 클리어/사망 로그.

### 7.3 보안 및 API 관리

- **API Key:** 서버 사이드(Cloud Functions) 환경변수로 관리. 유저는 접근 불가.
- **Rate Limit:** 유저당 하루 AI 생성 요청 횟수 제한 (예: 50회). 초과 시 광고 시청 또는 대기.
- **Validation:** 유저가 임의로 JSON을 조작해 `ATK: 99999`로 게시하는 것을 방지하기 위해, 게시 전 서버(`publishDungeon`)에서 난이도 대비 스탯 검증 로직 수행.

---

### ❌ 1. 완전 유지 (RPG 방식) - 비추천

_던전 A에서 얻은 '전설의 검'을 들고 던전 B로 가는 방식._

- **치명적 단점:**
  1.  **어뷰징 던전 범람:** 유저들이 "전설 아이템 퍼주는 방", "1초 만에 클리어 경험치 방" 같은 던전만 만들고 플레이합니다. (일명 '혜자 던전')
  2.  **난이도 설계 불가능:** 던전 제작자는 플레이어가 '나무 몽둥이'를 들고 올지, '신살자의 검'을 들고 올지 모릅니다. 밸런스를 잡을 수가 없어 재미가 없어집니다.
  3.  **진입 장벽:** 고인물과 뉴비의 격차가 너무 커져서, 뉴비가 만든 던전은 아무도 안 가고, 고인물 던전은 뉴비가 못 깹니다.

---

### ✅ 2. 하이브리드 방식 (로그라이트) - 추천

_던전에 들어갈 때는 **초기화**, 나오면 **보상(재화/수집품)만 챙겨 나오는** 방식._

던전 안에서의 성장과 밖에서의 성장을 분리하는 것입니다.

#### A. 던전 내부 (In-Game): "매번 새로운 도전"

- **초기화:** 플레이어는 어떤 던전에 들어가든 **Lv.1 / 기본 장비**로 시작합니다. (또는 약간의 보정을 받은 상태)
- **파밍:** 던전 안에서 획득한 장비, 물약, 유물은 **그 던전을 탈출(클리어)하거나 죽으면 사라집니다.**
- **장점:** 제작자는 "이 던전은 1레벨부터 시작해서 5레벨쯤에 보스를 만나게 설계해야지"라고 **정확한 난이도 의도**를 구현할 수 있습니다. 쫄깃한 긴장감이 유지됩니다.

#### B. 던전 외부 (Meta-Game): "내 계정의 성장"

던전에서 고생했는데 남는 게 없으면 허무하겠죠? 클리어 시 가지고 나오는 것은 **'아이템 실물'이 아니라 '재화와 데이터'**입니다.

1.  **골드/영혼석 (재화):**
    - 던전에서 얻은 재화는 가지고 나옵니다.
    - 이걸로 로비(Lobby)에서 **'기초 능력치 강화(패시브)'**나 **'직업 해금'**을 합니다. (예: 전사 초기 체력 +5)
    - 이러면 많이 플레이한 사람은 Lv.1이라도 조금 더 튼튼하게 시작할 수 있습니다.

2.  **도감(Collection) 등록:**
    - 던전에서 '전설의 검'을 먹어봤다면, **[아이템 도감]**에 기록됩니다.
    - 도감을 채우는 수집욕을 자극합니다.

3.  **카드 제작 재료:**
    - 다른 사람의 던전을 깨면, **'특수 키워드'**나 **'AI 생성 토큰'**을 얻습니다.
    - _예:_ 얼음 던전을 깼더니 '냉기' 속성 카드 생성 권한을 얻음.
    - 즉, **플레이(Play)를 해야 내 던전 만들기(Build)가 더 강력해지는 선순환** 구조입니다.

---

### 💡 제안하는 구체적 시스템

이 게임에 딱 맞는 **[유물 추출 시스템]**을 제안합니다.

1.  **입장 시:**
    - 기본 장비 지급. (직업별 고정)
    - 유저가 로비에서 장착한 **'유물(Perk)' 1~2개**만 들고 입장 가능. (소소한 보너스 효과)

2.  **플레이 중:**
    - 던전에서 드랍되는 장비는 그 판에서만 쓰고 소멸.

3.  **클리어 보상:**
    - 던전에서 획득한 아이템 중 **하나를 골라 '에센스'로 추출.**
    - 추출된 에센스는 돈이나 경험치로 환산되거나, 낮은 확률로 **'영구 소장용 스킨'** 혹은 **'로비 장식물'**이 됨.

---
