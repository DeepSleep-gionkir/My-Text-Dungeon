# Massive Update 2026-02-06

## 목표
이번 업데이트는 "안정성/리스크 제어/밸런스/UX/스크린 호환성"을 동시에 강화하는 구조 개편에 초점을 둔다.

## 1) 안정성 / 리스크 제어
### 런타임 던전 데이터 방어
- 플레이 런타임에서 던전 카드 데이터를 강제 정규화하도록 변경.
- 잘못된 카테고리/누락 필드/손상된 카드가 있어도 안전한 대체 카드로 복구.
- 비정상적으로 큰 던전(`room_total`)은 런타임 상한으로 제한해 성능 리스크 차단.

### 전역 오류 복구
- 글로벌 오류 화면 추가(`src/app/error.tsx`).
- 404 화면 추가(`src/app/not-found.tsx`).
- 클라이언트 에러 바운더리(`AppErrorBoundary`) 추가로 런타임 UI 붕괴 시 복구 버튼 제공.

### AI 호출 신뢰성 강화
- Gemini 호출에 타임아웃/재시도/지수 백오프 추가.
- 프롬프트 길이 안전 절단 처리 추가.
- JSON 응답 파싱 실패 시 다단계 복구 강화.

## 2) 밸런스 시스템 강화
### 진행도 기반 동적 스케일링
- 진행도(런 초반~후반)에 따라 위험도와 보상이 자연스럽게 증가하도록 공통 함수 추가.
- 함정 피해량: 난이도 + 진행도 반영.
- 기본 보상(저자 미설정 시)도 진행도 반영.

### 경제 안전장치
- 카드 정규화 단계에서 보상 골드/XP/상점 가격에 난이도 기반 상한 적용.
- 상점은 최소 1개 이상 "초기 자금으로 구매 가능한 아이템"을 보장.

### 카드 품질 정규화 강화
- 태그는 허용 프리픽스만 유지.
- 액션 trigger/chance/count/value 범위를 정규화.
- 전투 카드 스탯은 난이도/카테고리 기반 상한·하한으로 캡핑.
- 함정 체크 DC는 난이도별 권장 구간으로 고정.

## 3) UI / 접근성 / 스크린 호환성
### 모바일/화면 적응성
- `viewportFit: cover` 적용.
- 안전영역(safe-area) 인셋 적용으로 노치 기기 대응.
- 초소형 화면(<=360px) 폰트 스케일 보정.
- 터치 기기에서 최소 터치 영역/입력 폰트 크기 개선.

### 모션 접근성
- `prefers-reduced-motion` 환경에서 애니메이션/트랜지션 최소화.
- 라우트 전환 애니메이션도 감축 모드 반영.

### 입력/폼 일관성
- 공통 입력 스타일(`input-surface`) 적용 확대.
- 빌더 채팅 입력의 접근성 속성(ARIA, 길이 제한, 자동완성 제어) 보강.

## 4) 플레이 체감 개선 포인트
- 후반부 긴장감은 유지하되, 초반부 과도한 랜덤 박탈감 완화.
- 비정상 데이터가 섞여도 런이 "중단"되지 않고 "안전 진행"되도록 설계.
- 던전 제작자 입력 품질 편차가 플레이어 경험을 망가뜨리는 문제를 완화.

## 5) 검증
- `npm run lint` 통과
- `npm run build` 통과

## 6) 다음 권장 고도화
1. 전투 공식/상태이상/보상 정산을 별도 엔진 모듈로 완전 분리
2. 밸런스 시뮬레이터(난이도별 완주율/경제 분포) 자동화
3. 카드 생성 단계에 서버측 검증(게시 전 밸런스 룰 강제) 추가
